<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="./jquery.js" type="application/javascript"></script>    

</head>

<script type="application/javascript">

function listarDiscos(){

    //Directamente con javascript
    
    let xhr = new XMLHttpRequest()
    xhr.open('GET', 'http://localhost:3000/discos')
    xhr.onload = function(){
        if(this.status != 200){
            console.log("NO HA SIDO UN 200!!!")
            return
        }
        rellenarTabla(JSON.parse(this.responseText))
    }
    xhr.onerror = function(){
        procesarError('ZASCA!')
    }    
    xhr.send()

}

function procesarError(){
    alert("ERROR!")
}

function rellenarTabla(discos){

    $("#tablaDiscos").html('')

    for(let disco of discos){
        $(`
        <tr>
            <td>${disco.titulo}</td>
            <td>${disco.grupo}</td>
            <td>${disco.year}</td>
            <td>${disco.discografica}</td>
        </tr>        
        `)
        .appendTo("#tablaDiscos")
    }

}


$(inicializar)

function inicializar(){
    $("#btnListar").click(listarDiscos)
}

</script>

<body>

    <h1>18_JQuery_AJAX</h1>

    <hr/>

    <p align="center">
        <button id="btnListar">Listar discos</button>
    </p>

    <div id="mensaje"></div>

    <div>
        <table border="1" align="center">
            <tr>
                <th>Título</th>
                <th>Grupo</th>
                <th>Año</th>
                <th>Discográfica</th>
            </tr>
            <tbody id="tablaDiscos"></tbody>
        </table>


    </div>
       
</body>


</html>